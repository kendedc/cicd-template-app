name: project-name

trigger:
  branches:
    include:
      - main
      - development
      - staging

resources:
  repositories:
    - repository: cicd-templates
      type: github
      name: kendedc/test-cicd-template
      ref: refs/heads/main
      endpoint: kendedc

variables:
- group: 'testing template app'

parameters:
- name: nodeVersion
  type: string
  default: "20.x"
- name: isTest
  type: boolean
  default: true

pool:
  vmImage: ubuntu-latest

stages:
- stage: Build
  displayName: "Build Stage"
  jobs:
  - job: InstallNode
    displayName: "Install Node Job"
    steps:
    - template: install-node.yml@cicd-templates
      parameters:
        nodeVersion: ${{ parameters.nodeVersion }}
  - job: Build
    displayName: "Build Job"
    dependsOn: InstallNode
    steps:
    - template: ci-steps.yml@cicd-templates

- stage: Deploy
  displayName: "Deploy Stage"
  dependsOn: Build
  condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))
  jobs:
  - job: Deploy
    displayName: "Deploy Job"
    steps:
    - template: cd-steps.yml@cicd-templates
